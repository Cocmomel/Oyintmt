<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>21 Ochko (Blackjack)</title>
<style>
  body { font-family: Arial, sans-serif; background: #2e7d32; color: white; text-align: center; }
  #game { margin: 20px auto; max-width: 600px; }
  .cards { margin: 10px; }
  .card { display: inline-block; width: 60px; height: 90px; border-radius: 8px; background: white; color: black; font-size: 24px; line-height: 90px; margin: 5px; }
  button { font-size: 18px; margin: 10px; padding: 10px 20px; }
</style>
</head>
<body>
<h1>21 Ochko</h1>
<div id="betInfo"></div>
<div id="dealer" class="cards"></div>
<div id="player" class="cards"></div>
<div>
  <button id="hitBtn">Yana karta</button>
  <button id="standBtn">To'xtash</button>
</div>
<div id="result"></div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const bet = parseInt(urlParams.get('bet')) || 0;
const userId = urlParams.get('user_id');

document.getElementById('betInfo').innerText = `Tikilgan pul: ${bet} virtual pul`;

const deck = [];
const suits = ['♠','♥','♦','♣'];
const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

// Deck yaratish
function createDeck() {
  deck.length = 0;
  for(let s of suits){
    for(let r of ranks){
      deck.push({suit:s, rank:r});
    }
  }
}

// Kartani random olish
function drawCard(){
  return deck.splice(Math.floor(Math.random()*deck.length),1)[0];
}

// Kartalar qiymati
function cardValue(card, currentSum){
  if(card.rank === 'A'){
    return (currentSum + 11) <= 21 ? 11 : 1;
  }
  if(['J','Q','K'].includes(card.rank)) return 10;
  return parseInt(card.rank);
}

// O'yin holati
let playerCards = [];
let dealerCards = [];
let playerSum = 0;
let dealerSum = 0;
let gameOver = false;

function updateDisplay(){
  const playerDiv = document.getElementById('player');
  const dealerDiv = document.getElementById('dealer');
  playerDiv.innerHTML = '';
  dealerDiv.innerHTML = '';
  for(let c of playerCards){
    let cardDiv = document.createElement('div');
    cardDiv.className = 'card';
    cardDiv.innerText = c.rank + c.suit;
    playerDiv.appendChild(cardDiv);
  }
  for(let c of dealerCards){
    let cardDiv = document.createElement('div');
    cardDiv.className = 'card';
    cardDiv.innerText = c.rank + c.suit;
    dealerDiv.appendChild(cardDiv);
  }
  document.getElementById('result').innerText = `Siz: ${playerSum} | Diler: ${dealerSum}`;
}

// Diler o‘yin qoidasi
function dealerTurn(){
  while(dealerSum < 17){
    let card = drawCard();
    dealerCards.push(card);
    dealerSum += cardValue(card,dealerSum);
  }
}

// O'yin boshlanishi
function startGame(){
  createDeck();
  playerCards = [drawCard(), drawCard()];
  dealerCards = [drawCard(), drawCard()];
  playerSum = playerCards.reduce((sum,c) => sum + cardValue(c,sum), 0);
  dealerSum = dealerCards.reduce((sum,c) => sum + cardValue(c,sum), 0);
  updateDisplay();
  document.getElementById('result').innerText = 'Oʻyin boshlandi!';
  gameOver = false;
}

document.getElementById('hitBtn').onclick = function(){
  if(gameOver) return;
  let card = drawCard();
  playerCards.push(card);
  playerSum += cardValue(card,playerSum);
  updateDisplay();
  if(playerSum > 21){
    document.getElementById('result').innerText = 'Siz magʻlub boʻldingiz!';
    gameOver = true;
    sendResult('lose');
  }
}

document.getElementById('standBtn').onclick = function(){
  if(gameOver) return;
  dealerTurn();
  updateDisplay();
  if(dealerSum > 21 || playerSum > dealerSum){
    document.getElementById('result').innerText = 'Siz yutdingiz!';
    sendResult('win');
  } else if(playerSum === dealerSum){
    document.getElementById('result').innerText = 'Durang!';
    sendResult('draw');
  } else {
    document.getElementById('result').innerText = 'Siz magʻlub boʻldingiz!';
    sendResult('lose');
  }
  gameOver = true;
}

// Natijani botga yuborish funksiyasi (server API bilan bog‘lanadi)
function sendResult(result){
  // Mana bu yerga Telegram bot API yoki sizning server APIingizni qo‘shishingiz mumkin
  // Misol uchun fetch orqali natijani yuborish
  /*
  fetch('https://sizning-serveringiz/api/game-result', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user_id: userId, bet: bet, result: result})
  });
  */
  alert('O\'yin natijasi: ' + result + '\n(Backend bilan bog\'lanish kerak)');
}

startGame();
</script>
</body>
</html>
